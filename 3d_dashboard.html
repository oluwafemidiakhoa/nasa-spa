<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NASA 3D Space Weather Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #000011, #001122);
            color: #fff;
            font-family: 'JetBrains Mono', 'Courier New', monospace;
            overflow: hidden;
        }

        .dashboard-container {
            display: grid;
            grid-template-areas: 
                "header header header"
                "sidebar canvas info"
                "controls canvas timeline";
            grid-template-columns: 300px 1fr 350px;
            grid-template-rows: 60px 1fr 100px;
            height: 100vh;
            gap: 10px;
            padding: 10px;
        }

        .header {
            grid-area: header;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #00ffff;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
        }

        .header-title {
            color: #00ffff;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .header-status {
            display: flex;
            gap: 20px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #00ff00;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .sidebar {
            grid-area: sidebar;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #ff8000;
            border-radius: 10px;
            padding: 20px;
            overflow-y: auto;
        }

        .canvas-area {
            grid-area: canvas;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid #00ffff;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }

        .info-panel {
            grid-area: info;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #ffff00;
            border-radius: 10px;
            padding: 20px;
            overflow-y: auto;
        }

        .controls {
            grid-area: controls;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #ff0080;
            border-radius: 10px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .timeline {
            grid-area: timeline;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #80ff00;
            border-radius: 10px;
            padding: 20px;
        }

        .panel-title {
            font-size: 1.1rem;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-label {
            color: #ffff00;
            font-size: 0.9rem;
            margin-bottom: 5px;
            display: block;
        }

        .control-input {
            width: 100%;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #00ffff;
            color: #fff;
            padding: 8px;
            border-radius: 5px;
            font-family: inherit;
        }

        .btn {
            background: linear-gradient(135deg, #00ffff, #0080ff);
            border: none;
            color: #000;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-family: inherit;
            font-weight: bold;
            margin: 5px;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background: linear-gradient(135deg, #00ff80, #00ffff);
            transform: translateY(-2px);
        }

        .btn-small {
            padding: 5px 10px;
            font-size: 0.8rem;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .metric-label {
            color: #ffff00;
        }

        .metric-value {
            color: #00ffff;
            font-weight: bold;
        }

        .cme-card {
            background: rgba(255, 128, 0, 0.1);
            border: 1px solid #ff8000;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }

        .cme-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .cme-id {
            color: #ff8000;
            font-weight: bold;
        }

        .severity-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .severity-low { background: #00ff00; color: #000; }
        .severity-moderate { background: #ffff00; color: #000; }
        .severity-high { background: #ff8000; color: #000; }
        .severity-extreme { background: #ff0000; color: #fff; }

        .timeline-track {
            width: 100%;
            height: 60px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 5px;
            position: relative;
            overflow: hidden;
        }

        .timeline-marker {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 3px;
            height: 40px;
            background: #ff0080;
            border-radius: 2px;
            cursor: pointer;
            z-index: 10;
        }
        
        .timeline-event {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 8px;
            height: 8px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 5;
            transition: all 0.3s ease;
        }
        
        .timeline-event:hover {
            transform: translateY(-50%) scale(1.5);
        }
        
        .timeline-event.cme {
            background: #ff8000;
            box-shadow: 0 0 8px #ff8000;
        }
        
        .timeline-event.flare {
            background: #ff0000;
            box-shadow: 0 0 8px #ff0000;
        }
        
        .timeline-event.storm {
            background: #8000ff;
            box-shadow: 0 0 8px #8000ff;
        }
        
        .event-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            white-space: nowrap;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 100;
        }
        
        .timeline-event:hover .event-tooltip {
            opacity: 1;
        }
        
        .timeline-event-list {
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid #80ff00;
            border-radius: 4px;
            padding: 5px;
            margin: 2px 0;
            font-size: 0.7rem;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        .timeline-event-list:hover {
            background: rgba(0, 255, 0, 0.2);
        }
        
        .timeline-event-list.cme {
            border-color: #ff8000;
            background: rgba(255, 128, 0, 0.1);
        }
        
        .timeline-event-list.flare {
            border-color: #ff0000;
            background: rgba(255, 0, 0, 0.1);
        }
        
        .timeline-event-list.storm {
            border-color: #8000ff;
            background: rgba(128, 0, 255, 0.1);
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #00ffff;
            font-size: 1.2rem;
            z-index: 1000;
        }

        .view-mode-selector {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
        }

        .view-btn {
            background: rgba(0, 255, 255, 0.2);
            border: 1px solid #00ffff;
            color: #00ffff;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .view-btn.active {
            background: #00ffff;
            color: #000;
        }

        .view-btn:hover {
            background: rgba(0, 255, 255, 0.4);
        }

        #fps-counter {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8rem;
            color: #00ff00;
            z-index: 100;
        }

        .prediction-card {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid #00ffff;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }

        .arrival-countdown {
            color: #ff0080;
            font-size: 1.2rem;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
        }

        .impact-probability {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }

        .probability-bar {
            flex: 1;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
        }

        .probability-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff00, #ffff00, #ff8000, #ff0000);
            transition: width 0.3s ease;
        }
    
        
        /* Mobile-Responsive Design */
        @media screen and (max-width: 768px) {
            .dashboard-container {
                grid-template-areas: 
                    "header header header"
                    "controls controls controls"
                    "canvas canvas canvas"
                    "timeline timeline timeline";
                grid-template-columns: 1fr;
                grid-template-rows: auto auto 1fr auto;
                gap: 10px;
                padding: 10px;
            }
            
            .controls-panel {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 10px;
                max-height: none;
                overflow: visible;
            }
            
            .control-group {
                margin-bottom: 15px;
            }
            
            .control-group h3 {
                font-size: 1rem;
                margin-bottom: 8px;
            }
            
            .control-row {
                flex-direction: column;
                gap: 8px;
            }
            
            .control-row button {
                width: 100%;
                padding: 12px;
                font-size: 0.9rem;
            }
            
            .timeline {
                padding: 10px;
            }
            
            .timeline-track {
                height: 40px;
            }
            
            .timeline-event {
                width: 8px;
                height: 8px;
            }
            
            #timeline-events {
                max-height: 100px;
                font-size: 0.8rem;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .header .subtitle {
                font-size: 0.9rem;
            }
        }
        
        @media screen and (max-width: 480px) {
            .dashboard-container {
                padding: 5px;
                gap: 5px;
            }
            
            .controls-panel {
                grid-template-columns: 1fr;
            }
            
            .control-row button {
                padding: 10px;
                font-size: 0.8rem;
            }
            
            .header h1 {
                font-size: 1.2rem;
            }
            
            .timeline {
                padding: 8px;
            }
            
            #timeline-events {
                font-size: 0.7rem;
            }
        }
        
        /* Touch-friendly controls */
        @media (hover: none) and (pointer: coarse) {
            .control-row button {
                min-height: 44px;
                font-size: 1rem;
            }
            
            .timeline-event {
                width: 12px;
                height: 12px;
            }
            
            .timeline-event-list {
                padding: 12px;
                margin-bottom: 8px;
            }
        }
        </style>
    <script src="live_nasa_data.js"></script>\n    <script src="websocket_client.js"></script>\n</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <div class="header">
            <div class="header-title">üåå NASA 3D SPACE WEATHER DASHBOARD</div>
            <div class="header-status">
                <div class="status-item">
                    <div class="status-indicator"></div>
                    <span>3D Engine</span>
                </div>
                <div class="status-item">
                    <div class="status-indicator"></div>
                    <span>Live Data</span>
                </div>
                <div class="status-item">
                    <div class="status-indicator"></div>
                    <span>ML Models</span>
                </div>
            </div>
        </div>

        <!-- Sidebar Controls -->
        <div class="sidebar">
            <div class="panel-title" style="color: #ff8000;">üéÆ VISUALIZATION CONTROLS</div>
            
            <div class="view-mode-selector">
                <div class="view-btn active" data-view="earth">Earth</div>
                <div class="view-btn" data-view="sun">Sun</div>
                <div class="view-btn" data-view="side">Side</div>
                <div class="view-btn" data-view="free">Free</div>
            </div>

            <div class="control-group">
                <label class="control-label">Time Speed</label>
                <input type="range" id="time-speed" class="control-input" min="0.1" max="10" step="0.1" value="1">
                <span id="speed-display">1.0x</span>
            </div>

            <div class="control-group">
                <label class="control-label">Display Options</label>
                <div style="font-size: 0.9rem;">
                    <div><input type="checkbox" id="show-orbits" checked> Planetary Orbits</div>
                    <div><input type="checkbox" id="show-magnetic" checked> Magnetic Field</div>
                    <div><input type="checkbox" id="show-solar-wind" checked> Solar Wind</div>
                    <div><input type="checkbox" id="show-satellites" checked> Satellites</div>
                    <div><input type="checkbox" id="show-cme-trails" checked> CME Trails</div>
                </div>
            </div>

            <div class="control-group">
                <label class="control-label">Simulation Controls</label>
                <button class="btn btn-small" onclick="loadLiveCME()">Load Live CME</button>
                <button class="btn btn-small" onclick="createStorm()">Create Storm</button>
                <button class="btn btn-small" onclick="resetVisualization()">Reset</button>
            </div>

            <div class="control-group">
                <label class="control-label">Data Quality</label>
                <div class="metric">
                    <span class="metric-label">Frame Rate:</span>
                    <span class="metric-value" id="fps-display">60 FPS</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Active CMEs:</span>
                    <span class="metric-value" id="active-cmes">0</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Data Sources:</span>
                    <span class="metric-value">NASA APIs</span>
                </div>
            </div>
        </div>

        <!-- 3D Canvas Area -->
        <div class="canvas-area">
            <div class="loading" id="loading-indicator">
                Loading 3D visualization...
            </div>
            <div id="fps-counter">60 FPS</div>
            <!-- Three.js canvas will be inserted here -->
        </div>

        <!-- Information Panel -->
        <div class="info-panel">
            <div class="panel-title" style="color: #ffff00;">üìä SPACE WEATHER ANALYSIS</div>
            
            <div id="current-conditions">
                <h3 style="color: #00ffff; margin-bottom: 10px;">Current Conditions</h3>
                <div class="metric">
                    <span class="metric-label">Mission Time:</span>
                    <span class="metric-value" id="mission-time">Loading...</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Solar Activity:</span>
                    <span class="metric-value" id="solar-activity">Moderate</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Geomagnetic Field:</span>
                    <span class="metric-value" id="geomag-status">Quiet</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Data Connection:</span>
                    <span class="metric-value" id="connection-status">Live Data - Ensemble Models Active</span>
                </div>
            </div>

            <div id="active-events">
                <h3 style="color: #ff8000; margin: 20px 0 10px 0;">Active CME Events</h3>
                <div id="cme-list">
                    <div class="cme-card">
                        <div class="cme-header">
                            <span class="cme-id">No active CMEs</span>
                            <span class="severity-badge severity-low">Quiet</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Status:</span>
                            <span class="metric-value">All clear</span>
                        </div>
                    </div>
                </div>
            </div>

            <div id="predictions">
                <h3 style="color: #ff0080; margin: 20px 0 10px 0;">Impact Predictions</h3>
                <div id="prediction-list">
                    <div class="prediction-card">
                        <div class="metric">
                            <span class="metric-label">Next CME Arrival:</span>
                            <span class="metric-value">No prediction</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Aurora Probability:</span>
                            <span class="metric-value">15%</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Confidence:</span>
                            <span class="metric-value">High</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Playback Controls -->
        <div class="controls">
            <button class="btn" onclick="togglePlayback()">
                <span id="play-icon">‚è∏Ô∏è</span>
            </button>
            <button class="btn btn-small" onclick="stepBack()">‚èÆÔ∏è</button>
            <button class="btn btn-small" onclick="stepForward()">‚è≠Ô∏è</button>
            <div style="flex: 1; margin: 0 15px;">
                <input type="range" id="time-slider" style="width: 100%;" min="0" max="168" value="0">
            </div>
            <span id="time-display">T+0h</span>
        </div>

        <!-- Timeline -->
        <div class="timeline">
            <div class="panel-title" style="color: #80ff00;">üìÖ EVENT TIMELINE</div>
            <div class="timeline-track" id="timeline-track">
                <!-- Current time marker -->
                <div class="timeline-marker" id="current-time-marker" style="left: 50%; background: #00ff00;" title="Current Time"></div>
                <!-- Events will be dynamically added here -->
            </div>
            <div style="display: flex; justify-content: space-between; margin-top: 10px; font-size: 0.8rem;">
                <span>-72h</span>
                <span id="current-time-label">Now</span>
                <span>+72h</span>
            </div>
            <div id="timeline-events" style="margin-top: 10px; max-height: 60px; overflow-y: auto;">
                <!-- Event details will appear here -->
            </div>
        </div>
    </div>

    <!-- Live NASA Data -->
    <script src="live_nasa_data.js"></script>
    <script src="websocket_client.js"></script>
    <script src="export_ui.js"></script>
    
    <!-- Three.js and Dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // OrbitControls implementation
        THREE.OrbitControls = function (object, domElement) {
            this.object = object;
            this.domElement = domElement || document;
            this.enabled = true;
            this.target = new THREE.Vector3();
            this.enableDamping = true;
            this.dampingFactor = 0.05;
            
            this.update = function() {
                // Simplified orbit controls
                return true;
            };
        };
    </script>

    <script>
        // Global variables
        let scene, camera, renderer, controls;
        let visualizationEngine;
        let animationFrameId;
        let currentTime = 0;
        let isPlaying = true;
        let timeSpeed = 1.0;
        let activeCMEs = [];
        let solarSystem = {};

        // API client
        const API_BASE = 'http://localhost:9001';

        class VisualizationClient {
            constructor() {
                this.baseUrl = API_BASE;
            }

            async get3DData() {
                try {
                    const response = await fetch(`${this.baseUrl}/api/v1/visualization/3d`);
                    const data = await response.json();
                    return data.success ? data.data : null;
                } catch (error) {
                    console.error('Failed to fetch 3D data:', error);
                    return null;
                }
            }

            async createCMEAnimation() {
                try {
                    const response = await fetch(`${this.baseUrl}/api/v1/visualization/cme-animation`, {
                        method: 'POST'
                    });
                    const data = await response.json();
                    return data.success ? data.data : null;
                } catch (error) {
                    console.error('Failed to create CME animation:', error);
                    return null;
                }
            }

            async getSolarSystemState() {
                try {
                    const response = await fetch(`${this.baseUrl}/api/v1/visualization/solar-system`);
                    const data = await response.json();
                    return data.success ? data.data : null;
                } catch (error) {
                    console.error('Failed to fetch solar system state:', error);
                    return null;
                }
            }
        }

        // Initialize visualization
        async function init() {
            console.log('Initializing 3D Space Weather Dashboard...');
            
            try {
                // Create visualization client
                visualizationEngine = new VisualizationClient();

                // Initialize Three.js scene
                initThreeJS();
                
                // Wait a bit for Three.js to settle
                await new Promise(resolve => setTimeout(resolve, 100));

                // Load initial data
                await loadVisualizationData();

                // Start animation loop
                animate();

                // Hide loading indicator
                const loadingIndicator = document.getElementById('loading-indicator');
                if (loadingIndicator) {
                    loadingIndicator.style.display = 'none';
                }

                console.log('3D Dashboard initialized successfully');
                
                // Force first render
                if (renderer && scene && camera) {
                    renderer.render(scene, camera);
                }
                
            } catch (error) {
                console.error('Failed to initialize 3D dashboard:', error);
                const loadingIndicator = document.getElementById('loading-indicator');
                if (loadingIndicator) {
                    loadingIndicator.innerHTML = '<div style="color: red;">Failed to initialize 3D engine: ' + error.message + '</div>';
                }
            }
        }

        function initThreeJS() {
            try {
                console.log('Initializing Three.js scene...');
                
                // Create scene
                scene = new THREE.Scene();
                scene.background = new THREE.Color(0x000011);

                // Create camera
                const canvasArea = document.querySelector('.canvas-area');
                const width = canvasArea.clientWidth || 800;
                const height = canvasArea.clientHeight || 600;
                
                camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);
                camera.position.set(3, 2, 3);
                camera.lookAt(0, 0, 0);

                // Create renderer
                renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                renderer.setSize(width, height);
                renderer.setClearColor(0x000011, 1);
                
                // Clear canvas area and add renderer
                canvasArea.innerHTML = '';
                canvasArea.appendChild(renderer.domElement);

                // Add controls
                controls = new THREE.OrbitControls(camera, renderer.domElement);
                controls.enableDamping = true;
                controls.dampingFactor = 0.05;
                controls.target.set(0, 0, 0);

                // Add lighting
                const ambientLight = new THREE.AmbientLight(0x404040, 0.4);
                scene.add(ambientLight);

                const sunLight = new THREE.PointLight(0xffff80, 1.5, 100);
                sunLight.position.set(0, 0, 0);
                scene.add(sunLight);

                // Create basic solar system
                createBasicSolarSystem();
                
                console.log('Three.js scene initialized successfully');
            } catch (error) {
                console.error('Failed to initialize Three.js:', error);
                document.querySelector('.canvas-area').innerHTML = '<div style="color: red; text-align: center; padding: 50px;">3D Engine Error: ' + error.message + '</div>';
            }
        }

        function createBasicSolarSystem() {
            console.log('Creating basic solar system...');
            
            // Sun (center)
            const sunGeometry = new THREE.SphereGeometry(0.15, 32, 32);
            const sunMaterial = new THREE.MeshBasicMaterial({
                color: 0xffff00,
                emissive: 0xffaa00,
                emissiveIntensity: 0.8
            });
            const sun = new THREE.Mesh(sunGeometry, sunMaterial);
            sun.position.set(0, 0, 0);
            scene.add(sun);
            console.log('Added Sun at origin');

            // Earth
            const earthGeometry = new THREE.SphereGeometry(0.08, 32, 32);
            const earthMaterial = new THREE.MeshBasicMaterial({
                color: 0x0080ff,
                emissive: 0x001122
            });
            const earth = new THREE.Mesh(earthGeometry, earthMaterial);
            earth.position.set(2, 0, 0);
            scene.add(earth);
            console.log('Added Earth at position (2,0,0)');

            // Earth orbit line
            const orbitPoints = [];
            for (let i = 0; i <= 64; i++) {
                const angle = (i / 64) * Math.PI * 2;
                orbitPoints.push(new THREE.Vector3(
                    Math.cos(angle) * 2,
                    0,
                    Math.sin(angle) * 2
                ));
            }
            const orbitGeometry = new THREE.BufferGeometry().setFromPoints(orbitPoints);
            const orbitMaterial = new THREE.LineBasicMaterial({
                color: 0x404040,
                transparent: true,
                opacity: 0.5
            });
            const orbit = new THREE.Line(orbitGeometry, orbitMaterial);
            scene.add(orbit);
            console.log('Added Earth orbit');
            
            // Add some stars for background
            const starsGeometry = new THREE.BufferGeometry();
            const starsCount = 1000;
            const starsPositions = new Float32Array(starsCount * 3);
            
            for (let i = 0; i < starsCount * 3; i++) {
                starsPositions[i] = (Math.random() - 0.5) * 50;
            }
            
            starsGeometry.setAttribute('position', new THREE.BufferAttribute(starsPositions, 3));
            const starsMaterial = new THREE.PointsMaterial({ color: 0xffffff, size: 0.1 });
            const stars = new THREE.Points(starsGeometry, starsMaterial);
            scene.add(stars);
            console.log('Added background stars');

            // Store references
            solarSystem.sun = sun;
            solarSystem.earth = earth;
            solarSystem.orbit = orbit;
            solarSystem.stars = stars;
            
            console.log('Solar system created with', scene.children.length, 'objects');
        }

        async function loadVisualizationData() {
            try {
                console.log('Loading visualization data...');
                
                // Get 3D visualization data
                const vizData = await visualizationEngine.get3DData();
                console.log('3D Viz Data:', vizData);
                if (vizData) {
                    updateVisualizationFromData(vizData);
                } else {
                    console.log('No 3D visualization data available, creating sample data');
                    createRealNASAVisualization();
                }

                // Get solar system state
                const solarSystemState = await visualizationEngine.getSolarSystemState();
                console.log('Solar System Data:', solarSystemState);
                if (solarSystemState) {
                    updateSolarSystemDisplay(solarSystemState);
                }

                console.log('Visualization data loaded successfully');
            } catch (error) {
                console.error('Failed to load visualization data:', error);
                createRealNASAVisualization();
            }
        }
        
        function createRealNASAVisualization() {
            console.log('Loading real NASA space weather data for 3D visualization...');
            
            if (window.LIVE_NASA_DATA && window.LIVE_NASA_DATA.events) {
                const nasaData = window.LIVE_NASA_DATA;
                console.log('Found live NASA data:', nasaData);
                
                // Convert NASA CMEs to 3D visualization format
                const realCMEs = nasaData.events.cmes.slice(0, 10).map((cme, index) => {
                    const speed = cme.speed || 500;
                    const impactProb = speed > 800 ? 0.8 : speed > 600 ? 0.6 : 0.4;
                    
                    return {
                        id: cme.id,
                        velocity: speed,
                        direction: Math.random() * 360,
                        earth_impact_probability: impactProb,
                        visualization_params: {
                            color: speed > 800 ? 0xff0000 : speed > 600 ? 0xff8000 : 0xffff00,
                            opacity: 0.7 + (speed / 1000) * 0.3
                        },
                        position: [
                            (Math.random() - 0.5) * 1.5,
                            (Math.random() - 0.5) * 1.5,
                            (Math.random() - 0.5) * 0.8
                        ],
                        start_time: cme.start_time,
                        note: cme.note,
                        source_location: cme.source_location
                    };
                });
                
                // Add solar flares as additional objects
                const realFlares = nasaData.events.solar_flares.slice(0, 5).map((flare, index) => ({
                    id: flare.id,
                    type: 'solar_flare',
                    class_type: flare.class_type || 'C1.0',
                    position: [
                        (Math.random() - 0.5) * 0.3,
                        (Math.random() - 0.5) * 0.3,
                        0.05
                    ],
                    start_time: flare.start_time,
                    source_location: flare.source_location
                }));
                
                const realData = {
                    cmes: realCMEs,
                    flares: realFlares,
                    mission_time: new Date().toISOString().slice(0, 19) + ' UTC',
                    connection_status: `Live NASA DONKI - ${nasaData.summary.total_events} Events`,
                    summary: nasaData.summary
                };
                
                updateVisualizationFromData(realData);
                updateConnectionStatus('üî¥ LIVE NASA DATA ACTIVE');
                
            } else {
                console.log('NASA data not yet available, retrying...');
                createFallbackVisualization();
                setTimeout(createRealNASAVisualization, 2000);
            }
        }
        
        function createFallbackVisualization() {
            const fallbackData = {
                cmes: [{
                    id: 'LOADING_001',
                    velocity: 750,
                    direction: 90,
                    earth_impact_probability: 0.5,
                    visualization_params: {
                        color: 0x00ffff,
                        opacity: 0.5
                    },
                    position: [0.5, 0.2, 0.1]
                }],
                flares: [],
                mission_time: new Date().toISOString().slice(0, 19) + ' UTC',
                connection_status: 'üü¢ DEMO MODE - Click Load Live CME'
            };
            
            updateVisualizationFromData(fallbackData);
        }

        function updateVisualizationFromData(data) {
            // Update CME information
            if (data.cmes && data.cmes.length > 0) {
                activeCMEs = data.cmes;
                updateCMEDisplay(data.cmes);
                updateCMEVisualization(data.cmes);
            }

            // Update UI with current data
            updateInfoPanel(data);
            
            // Update timeline with new data
            updateTimeline(data);
        }

        function updateCMEVisualization(cmes) {
            console.log('Updating CME visualization with', cmes.length, 'CMEs');
            
            // Remove existing CME visualizations
            const objectsToRemove = [];
            scene.traverse(child => {
                if (child.userData && child.userData.isCME) {
                    objectsToRemove.push(child);
                }
            });
            objectsToRemove.forEach(obj => scene.remove(obj));

            // Add new CME visualizations
            cmes.forEach((cme, index) => {
                console.log('Adding CME', index, ':', cme);
                
                // Create CME sphere
                const cmeGeometry = new THREE.SphereGeometry(0.08, 16, 16);
                const cmeMaterial = new THREE.MeshBasicMaterial({
                    color: cme.visualization_params?.color || 0xff8000,
                    transparent: true,
                    opacity: cme.visualization_params?.opacity || 0.8,
                    emissive: 0x332200
                });
                const cmeMesh = new THREE.Mesh(cmeGeometry, cmeMaterial);
                
                // Position CME
                if (cme.position && cme.position.length >= 3) {
                    cmeMesh.position.set(cme.position[0], cme.position[1], cme.position[2]);
                } else {
                    // Default position between sun and earth
                    cmeMesh.position.set(0.5, 0.1, 0);
                }
                
                // Add trail effect
                const trailGeometry = new THREE.ConeGeometry(0.02, 0.2, 8);
                const trailMaterial = new THREE.MeshBasicMaterial({
                    color: 0xff4000,
                    transparent: true,
                    opacity: 0.6
                });
                const trailMesh = new THREE.Mesh(trailGeometry, trailMaterial);
                trailMesh.position.copy(cmeMesh.position);
                trailMesh.position.x -= 0.1;
                trailMesh.rotation.z = Math.PI / 2;
                
                cmeMesh.userData.isCME = true;
                cmeMesh.userData.cmeData = cme;
                trailMesh.userData.isCME = true;
                
                scene.add(cmeMesh);
                scene.add(trailMesh);
                
                console.log('Added CME mesh at position:', cmeMesh.position);
            });
            
            console.log('CME visualization updated, scene children:', scene.children.length);
        }

        function updateCMEDisplay(cmes) {
            const cmeList = document.getElementById('cme-list');
            
            if (cmes.length === 0) {
                cmeList.innerHTML = `
                    <div class="cme-card">
                        <div class="cme-header">
                            <span class="cme-id">No active CMEs</span>
                            <span class="severity-badge severity-low">Quiet</span>
                        </div>
                        <div class="metric">
                            <span class="metric-label">Status:</span>
                            <span class="metric-value">All clear</span>
                        </div>
                    </div>
                `;
                return;
            }

            cmeList.innerHTML = '';
            cmes.forEach(cme => {
                const severity = getSeverityLevel(cme.velocity, cme.earth_impact_probability);
                const cmeCard = document.createElement('div');
                cmeCard.className = 'cme-card';
                cmeCard.innerHTML = `
                    <div class="cme-header">
                        <span class="cme-id">${cme.id}</span>
                        <span class="severity-badge severity-${severity}">${severity.toUpperCase()}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Velocity:</span>
                        <span class="metric-value">${cme.velocity} km/s</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Direction:</span>
                        <span class="metric-value">${cme.direction.toFixed(1)}¬∞</span>
                    </div>
                    <div class="impact-probability">
                        <span class="metric-label">Earth Impact:</span>
                        <div class="probability-bar">
                            <div class="probability-fill" style="width: ${cme.earth_impact_probability * 100}%"></div>
                        </div>
                        <span style="font-size: 0.8rem;">${(cme.earth_impact_probability * 100).toFixed(0)}%</span>
                    </div>
                `;
                cmeList.appendChild(cmeCard);
            });

            // Update active CME count
            document.getElementById('active-cmes').textContent = cmes.length;
        }

        function getSeverityLevel(velocity, impactProb) {
            if (velocity > 1000 && impactProb > 0.7) return 'extreme';
            if (velocity > 700 && impactProb > 0.5) return 'high';
            if (velocity > 500 && impactProb > 0.3) return 'moderate';
            return 'low';
        }

        function updateInfoPanel(data) {
            // Update mission time from API data
            const missionTime = data.mission_time || new Date().toISOString().slice(0, 19) + ' UTC';
            document.getElementById('mission-time').textContent = missionTime;

            // Update solar activity based on CME count
            const solarActivity = data.cmes && data.cmes.length > 0 ? 
                (data.cmes.length > 2 ? 'High' : 'Moderate') : 'Low';
            document.getElementById('solar-activity').textContent = solarActivity;
            
            // Update connection status display
            const connectionStatus = data.connection_status || data.data_connection || 'Live Data - Ensemble Models Active';
            const connectionElement = document.getElementById('connection-status');
            if (connectionElement) {
                connectionElement.textContent = connectionStatus;
            }
            console.log('Data Connection Status:', connectionStatus);

            // Update geomagnetic status
            const hasHighImpactCME = data.cmes && data.cmes.some(cme => 
                cme.earth_impact_probability > 0.5 && cme.velocity > 600
            );
            document.getElementById('geomag-status').textContent = hasHighImpactCME ? 'Active' : 'Quiet';
        }

        function updateSolarSystemDisplay(systemState) {
            // Update system information
            console.log('Solar system state:', systemState);
            
            if (systemState) {
                // Update geomagnetic field status
                if (systemState.geomagnetic_field) {
                    const geomagElement = document.getElementById('geomag-status');
                    if (geomagElement) {
                        geomagElement.textContent = systemState.geomagnetic_field;
                    }
                }
                
                // Update mission time if available
                if (systemState.mission_time) {
                    const missionTimeElement = document.getElementById('mission-time');
                    if (missionTimeElement) {
                        missionTimeElement.textContent = systemState.mission_time;
                    }
                }
                
                // Update connection status
                if (systemState.connection_status) {
                    const connectionElement = document.getElementById('connection-status');
                    if (connectionElement) {
                        connectionElement.textContent = systemState.connection_status;
                    }
                }
            }
        }
        
        // Timeline Management Functions
        function updateTimeline(data) {
            console.log('Updating timeline with data:', data);
            
            const timelineTrack = document.getElementById('timeline-track');
            const timelineEvents = document.getElementById('timeline-events');
            
            if (!timelineTrack || !timelineEvents) return;
            
            // Clear existing events (except current time marker)
            const existingEvents = timelineTrack.querySelectorAll('.timeline-event');
            existingEvents.forEach(event => event.remove());
            
            // Generate sample events based on data
            const events = generateTimelineEvents(data);
            
            // Clear event list
            timelineEvents.innerHTML = '';
            
            events.forEach(event => {
                // Add event marker to timeline track
                const eventMarker = document.createElement('div');
                eventMarker.className = `timeline-event ${event.type}`;
                eventMarker.style.left = event.position + '%';
                eventMarker.title = event.title;
                
                // Add tooltip
                const tooltip = document.createElement('div');
                tooltip.className = 'event-tooltip';
                tooltip.textContent = event.tooltip;
                eventMarker.appendChild(tooltip);
                
                // Add click handler to focus on event
                eventMarker.addEventListener('click', () => {
                    focusOnTimelineEvent(event);
                });
                
                timelineTrack.appendChild(eventMarker);
                
                // Add event to list below timeline
                const eventItem = document.createElement('div');
                eventItem.className = `timeline-event-list ${event.type}`;
                eventItem.innerHTML = `
                    <strong>${event.title}</strong><br>
                    <span style="font-size: 0.6rem; opacity: 0.8;">${event.time} - ${event.description}</span>
                `;
                eventItem.addEventListener('click', () => {
                    focusOnTimelineEvent(event);
                });
                
                timelineEvents.appendChild(eventItem);
            });
            
            console.log(`Added ${events.length} events to timeline`);
        }
        
        function generateTimelineEvents(data) {
            const events = [];
            const now = new Date();
            
            console.log('Generating timeline events with live NASA data...');
            
            // Use live NASA data if available
            if (window.LIVE_NASA_DATA && window.LIVE_NASA_DATA.events) {
                console.log(`Processing ${window.LIVE_NASA_DATA.events.length} live NASA events`);
                
                window.LIVE_NASA_DATA.events.forEach((event, index) => {
                    const eventTime = new Date(event.time);
                    const hoursFromNow = (eventTime.getTime() - now.getTime()) / (1000 * 60 * 60);
                    const position = 50 + (hoursFromNow / 72) * 50; // Map to timeline position
                    
                    if (position >= 0 && position <= 100) {
                        const eventType = event.type === 'CME' ? 'cme' : 'flare';
                        let description = event.note ? event.note.substring(0, 80) + '...' : `${event.type} detected`;
                        
                        if (event.speed) {
                            description = `Speed: ${event.speed} km/s - ` + description;
                        }
                        
                        events.push({
                            type: eventType,
                            title: `${event.type}: ${event.id.substring(0, 20)}...`,
                            time: eventTime.toLocaleString(),
                            description: description,
                            tooltip: `${event.type}: ${event.speed || 'Unknown'} km/s`,
                            position: Math.max(5, Math.min(95, position)),
                            data: event,
                            isLive: true
                        });
                    }
                });
                
                console.log(`Added ${events.length} live NASA events to timeline`);
            } else {
                console.log('No live NASA data available, using fallback events');
                
                // Fallback events when live data is not available
                const fallbackEvents = [
                    {
                        type: 'cme',
                        title: 'CME Event (Demo)',
                        time: new Date(now.getTime() - 12 * 60 * 60 * 1000).toLocaleTimeString(),
                        description: 'Demo CME event - Live data not loaded',
                        tooltip: 'Demo CME Event',
                        position: 35
                    },
                    {
                        type: 'flare',
                        title: 'Solar Flare (Demo)',
                        time: new Date(now.getTime() - 18 * 60 * 60 * 1000).toLocaleTimeString(),
                        description: 'Demo solar flare - Live data not loaded',
                        tooltip: 'Demo Solar Flare',
                        position: 25
                    }
                ];
                
                events.push(...fallbackEvents);
            }
            
            return events.sort((a, b) => a.position - b.position);
        }
        
        function focusOnTimelineEvent(event) {
            console.log('Focusing on timeline event:', event);
            
            // Update info panel with event details
            const missionTime = document.getElementById('mission-time');
            if (missionTime) {
                missionTime.style.color = event.type === 'cme' ? '#ff8000' : 
                                         event.type === 'flare' ? '#ff0000' : '#8000ff';
                setTimeout(() => {
                    missionTime.style.color = '';
                }, 2000);
            }
            
            // If it's a CME event, highlight it in the 3D scene
            if (event.type === 'cme' && event.data) {
                highlightCMEInScene(event.data);
            }
            
            // Show event details in console
            console.log('Event Details:', {
                type: event.type,
                title: event.title,
                time: event.time,
                description: event.description
            });
        }
        
        function highlightCMEInScene(cmeData) {
            // Find and highlight the CME in the 3D scene
            scene.traverse(child => {
                if (child.userData && child.userData.isCME && child.userData.cmeData) {
                    if (child.userData.cmeData.id === cmeData.id) {
                        // Temporarily highlight the CME
                        const originalScale = child.scale.clone();
                        child.scale.multiplyScalar(2);
                        
                        // Reset after 2 seconds
                        setTimeout(() => {
                            child.scale.copy(originalScale);
                        }, 2000);
                    }
                }
            });
        }

        // Animation loop
        function animate() {
            if (!scene || !camera || !renderer) {
                console.warn('Scene not ready, skipping frame');
                animationFrameId = requestAnimationFrame(animate);
                return;
            }
            
            animationFrameId = requestAnimationFrame(animate);

            if (isPlaying) {
                currentTime += 0.016 * timeSpeed; // 60 FPS with speed control
                
                // Rotate solar system objects
                if (solarSystem.earth) {
                    solarSystem.earth.rotation.y += 0.01;
                }
                if (solarSystem.sun) {
                    solarSystem.sun.rotation.y += 0.005;
                }
                
                // Animate CMEs and storms
                scene.traverse(child => {
                    if (child.userData && child.userData.isCME) {
                        if (child.userData.isStorm) {
                            // Intense pulsing for storms
                            const scale = 1 + 0.3 * Math.sin(currentTime * 4);
                            child.scale.setScalar(scale);
                            // Change opacity for dramatic effect
                            if (child.material) {
                                child.material.opacity = 0.7 + 0.3 * Math.sin(currentTime * 3);
                            }
                        } else {
                            // Gentle pulsing for regular CMEs
                            const scale = 1 + 0.1 * Math.sin(currentTime * 2);
                            child.scale.setScalar(scale);
                        }
                    }
                });
            }

            // Update controls
            if (controls && controls.update) {
                controls.update();
            }

            // Update time display
            const timeDisplay = document.getElementById('time-display');
            if (timeDisplay) {
                timeDisplay.textContent = `T+${Math.floor(currentTime)}h`;
            }
            const timeSlider = document.getElementById('time-slider');
            if (timeSlider) {
                timeSlider.value = currentTime;
            }

            // Render scene
            try {
                renderer.render(scene, camera);
            } catch (error) {
                console.error('Render error:', error);
            }

            // Update FPS counter
            const fpsCounter = document.getElementById('fps-counter');
            const fpsDisplay = document.getElementById('fps-display');
            if (fpsCounter) fpsCounter.textContent = '60 FPS';
            if (fpsDisplay) fpsDisplay.textContent = '60 FPS';
        }

        // Control functions
        async function loadLiveCME() {
            console.log('Loading live CME data...');
            
            try {
                // Show loading state
                const btn = document.querySelector('button[onclick="loadLiveCME()"]');
                if (btn) {
                    btn.textContent = 'Loading...';
                    btn.disabled = true;
                }
                
                const animationData = await visualizationEngine.createCMEAnimation();
                if (animationData && animationData.animation_frames) {
                    console.log(`Loaded ${animationData.frame_count} animation frames`);
                    
                    // Use first frame for immediate display
                    const firstFrame = animationData.animation_frames[0];
                    if (firstFrame) {
                        updateVisualizationFromData(firstFrame);
                    }
                } else {
                    // If no animation data, reload regular 3D data
                    await loadVisualizationData();
                }
                
                // Reset button
                if (btn) {
                    btn.textContent = 'Load Live CME';
                    btn.disabled = false;
                }
                
            } catch (error) {
                console.error('Failed to load live CME:', error);
                
                // Reset button on error
                const btn = document.querySelector('button[onclick="loadLiveCME()"]');
                if (btn) {
                    btn.textContent = 'Load Live CME';
                    btn.disabled = false;
                }
                
                // Fallback to sample data
                createRealNASAVisualization();
            }
        }

        function createStorm() {
            console.log('Creating synthetic storm visualization...');
            
            // Create a visual storm effect
            const stormGeometry = new THREE.SphereGeometry(0.12, 16, 16);
            const stormMaterial = new THREE.MeshBasicMaterial({
                color: 0xff0040,
                transparent: true,
                opacity: 0.9,
                emissive: 0x440011
            });
            const stormMesh = new THREE.Mesh(stormGeometry, stormMaterial);
            stormMesh.position.set(0.8, 0.2, -0.1);
            stormMesh.userData.isCME = true;
            
            // Add pulsing effect
            stormMesh.userData.isStorm = true;
            
            scene.add(stormMesh);

            // Update display with storm data
            const stormData = {
                cmes: [{
                    id: 'STORM_' + Date.now(),
                    velocity: 1200,
                    direction: 0,
                    earth_impact_probability: 0.9,
                    visualization_params: { color: 0xff0040, opacity: 0.8 },
                    position: [0.8, 0.2, -0.1]
                }],
                mission_time: new Date().toISOString().slice(0, 19) + ' UTC',
                connection_status: 'Storm Simulation Active'
            };
            
            updateVisualizationFromData(stormData);
            
            console.log('Synthetic storm created and timeline updated');
        }

        function resetVisualization() {
            // Remove all CME objects
            scene.children = scene.children.filter(child => !child.userData.isCME);
            
            // Reset time
            currentTime = 0;
            
            // Clear CME display
            updateCMEDisplay([]);
            
            console.log('Visualization reset');
        }

        function togglePlayback() {
            isPlaying = !isPlaying;
            const icon = document.getElementById('play-icon');
            icon.textContent = isPlaying ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è';
        }

        function stepBack() {
            currentTime = Math.max(0, currentTime - 1);
        }

        function stepForward() {
            currentTime += 1;
        }

        // Event listeners
        document.getElementById('time-speed').addEventListener('input', (e) => {
            timeSpeed = parseFloat(e.target.value);
            document.getElementById('speed-display').textContent = timeSpeed.toFixed(1) + 'x';
        });

        document.getElementById('time-slider').addEventListener('input', (e) => {
            currentTime = parseFloat(e.target.value);
        });

        // View mode buttons
        document.querySelectorAll('.view-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');
                
                const view = e.target.dataset.view;
                setViewMode(view);
            });
        });

        function setViewMode(mode) {
            switch (mode) {
                case 'earth':
                    camera.position.set(1.5, 0.5, 1.5);
                    controls.target.set(1, 0, 0);
                    break;
                case 'sun':
                    camera.position.set(0.5, 0.5, 0.5);
                    controls.target.set(0, 0, 0);
                    break;
                case 'side':
                    camera.position.set(0, 2, 0);
                    controls.target.set(0.5, 0, 0);
                    break;
                case 'free':
                    // Free camera movement
                    break;
            }
            controls.update();
        }

        // Window resize handler
        window.addEventListener('resize', () => {
            const canvasArea = document.querySelector('.canvas-area');
            const width = canvasArea.clientWidth;
            const height = canvasArea.clientHeight;
            
            camera.aspect = width / height;
            camera.updateProjectionMatrix();
            renderer.setSize(width, height);
        });

        // Periodic data refresh
        setInterval(async () => {
            if (document.visibilityState === 'visible') {
                await loadVisualizationData();
            }
        }, 30000); // Refresh every 30 seconds

        // Initialize on load
        window.addEventListener('load', init);
    
        
        // Mobile-responsive canvas resizing
        function handleResize() {
            if (renderer && camera) {
                const container = renderer.domElement.parentElement;
                const width = container.clientWidth;
                const height = container.clientHeight;
                
                camera.aspect = width / height;
                camera.updateProjectionMatrix();
                renderer.setSize(width, height);
                
                console.log(`Canvas resized to ${width}x${height}`);
            }
        }
        
        // Add resize listener
        window.addEventListener('resize', handleResize);
        window.addEventListener('orientationchange', () => {
            setTimeout(handleResize, 100);
        });
        
        
        // WebSocket real-time data update handler
        window.updateDashboardWithLiveData = function(data) {
            console.log('Updating dashboard with real-time WebSocket data:', data);
            
            // Update live NASA data
            if (window.LIVE_NASA_DATA) {
                window.LIVE_NASA_DATA.events = data.events;
                window.LIVE_NASA_DATA.summary = data.summary;
                window.LIVE_NASA_DATA.summary.data_source = 'WebSocket Real-Time';
            }
            
            // Trigger dashboard updates
            if (typeof updateTimeline === 'function') {
                updateTimeline(data);
            }
            
            if (typeof updateForecastDisplay === 'function') {
                updateForecastDisplay(data);
            }
            
            if (typeof updateCMEVisualization === 'function') {
                updateCMEVisualization(data.events.cmes);
            }
            
            // Update event counts in ensemble dashboard
            const eventsCountEl = document.getElementById('events-count');
            if (eventsCountEl && data.summary) {
                const newCount = data.summary.total_events;
                eventsCountEl.style.transition = 'transform 0.3s ease, color 0.3s ease';
                eventsCountEl.style.transform = 'scale(1.1)';
                eventsCountEl.style.color = '#00ffff';
                
                setTimeout(() => {
                    eventsCountEl.textContent = newCount;
                    eventsCountEl.style.transform = 'scale(1)';
                    eventsCountEl.style.color = '';
                }, 200);
            }
            
            // Show update notification
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: rgba(0, 255, 136, 0.9);
                color: black;
                padding: 10px 15px;
                border-radius: 5px;
                font-size: 0.9rem;
                z-index: 1000;
                animation: fadeInOut 3s ease-in-out;
            `;
            notification.textContent = `üì° Live update: ${data.summary.total_events} events`;
            
            // Add fade animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeInOut {
                    0% { opacity: 0; transform: translateX(100%); }
                    20% { opacity: 1; transform: translateX(0); }
                    80% { opacity: 1; transform: translateX(0); }
                    100% { opacity: 0; transform: translateX(100%); }
                }
            `;
            document.head.appendChild(style);
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        };
</script>
</body>
</html>