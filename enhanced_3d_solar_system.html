<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåü NASA 3D Space Weather Visualization - Real-Time</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.9/dat.gui.min.js"></script>
    <script src="live_nasa_data.js"></script>
    <script src="websocket_client.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: radial-gradient(ellipse at center, #0f0f23 0%, #000000 100%);
            color: #fff;
            font-family: 'JetBrains Mono', 'Courier New', monospace;
            overflow: hidden;
        }

        #canvas-container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }

        #hud-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }

        .hud-panel {
            position: absolute;
            background: rgba(0, 20, 40, 0.9);
            border: 2px solid #00ffff;
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.3);
            pointer-events: auto;
        }

        #mission-control {
            top: 20px;
            left: 20px;
            min-width: 320px;
        }

        #data-panel {
            top: 20px;
            right: 20px;
            min-width: 350px;
            max-height: 70vh;
            overflow-y: auto;
        }

        #timeline-panel {
            bottom: 20px;
            left: 20px;
            right: 20px;
            height: 120px;
        }

        .panel-title {
            color: #00ffff;
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
            border-bottom: 2px solid #00ffff;
            padding-bottom: 8px;
        }

        .status-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .status-item {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid #00ffff;
            border-radius: 6px;
            padding: 10px;
            text-align: center;
        }

        .status-value {
            font-size: 1.4rem;
            font-weight: bold;
            color: #00ff00;
            margin-bottom: 4px;
        }

        .status-label {
            font-size: 0.8rem;
            color: #ccc;
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-label {
            color: #ffff00;
            font-size: 0.9rem;
            margin-bottom: 5px;
            display: block;
        }

        .control-slider {
            width: 100%;
            margin-bottom: 10px;
        }

        .control-button {
            background: linear-gradient(135deg, #00bfff, #0080ff);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.9rem;
            margin: 3px;
            transition: all 0.3s ease;
        }

        .control-button:hover {
            background: linear-gradient(135deg, #00ffff, #00bfff);
            transform: translateY(-1px);
        }

        .control-button.active {
            background: linear-gradient(135deg, #ff8000, #ff4000);
        }

        .event-item {
            background: rgba(255, 128, 0, 0.1);
            border: 1px solid #ff8000;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .event-item:hover {
            background: rgba(255, 128, 0, 0.2);
            transform: translateX(5px);
        }

        .event-id {
            color: #ff8000;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .event-details {
            color: #ccc;
            font-size: 0.8rem;
            margin-top: 5px;
        }

        .timeline-container {
            position: relative;
            height: 60px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            overflow: hidden;
        }

        .timeline-track {
            position: absolute;
            top: 25px;
            left: 20px;
            right: 20px;
            height: 10px;
            background: linear-gradient(90deg, #004080, #0080ff, #00ffff);
            border-radius: 5px;
        }

        .timeline-marker {
            position: absolute;
            width: 6px;
            height: 20px;
            background: #ff0000;
            border-radius: 3px;
            top: 20px;
            transform: translateX(-50%);
            cursor: pointer;
        }

        .loading-spinner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #00ffff;
            font-size: 1.5rem;
            z-index: 2000;
        }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .spinning {
            animation: spin 2s linear infinite;
        }

        .connection-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        .connected { background: #00ff00; }
        .connecting { background: #ffff00; }
        .disconnected { background: #ff0000; }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        @media (max-width: 768px) {
            .hud-panel {
                font-size: 0.8rem;
                padding: 15px;
            }
            
            #mission-control, #data-panel {
                min-width: 280px;
            }
        }
    </style>
</head>
<body>
    <div id="canvas-container"></div>
    
    <div id="hud-overlay">
        <!-- Mission Control Panel -->
        <div id="mission-control" class="hud-panel">
            <div class="panel-title">üõ∞Ô∏è MISSION CONTROL</div>
            
            <div class="status-grid">
                <div class="status-item">
                    <div class="status-value" id="cme-count">0</div>
                    <div class="status-label">CME Events</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="flare-count">0</div>
                    <div class="status-label">Solar Flares</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="activity-level">QUIET</div>
                    <div class="status-label">Activity Level</div>
                </div>
                <div class="status-item">
                    <div class="status-value" id="data-status">
                        <span class="connection-indicator connecting"></span>LOADING
                    </div>
                    <div class="status-label">Data Connection</div>
                </div>
            </div>

            <div class="control-group">
                <label class="control-label">üéÆ Visualization Controls</label>
                <button class="control-button" onclick="toggleAnimation()">‚èØÔ∏è Play/Pause</button>
                <button class="control-button" onclick="resetView()">üîÑ Reset View</button>
                <button class="control-button" onclick="toggleFullscreen()">üñºÔ∏è Fullscreen</button>
            </div>

            <div class="control-group">
                <label class="control-label">üåç Camera Speed</label>
                <input type="range" class="control-slider" id="camera-speed" min="0.1" max="2" step="0.1" value="1" onchange="updateCameraSpeed(this.value)">
            </div>

            <div class="control-group">
                <label class="control-label">‚ö° CME Intensity</label>
                <input type="range" class="control-slider" id="cme-intensity" min="0.1" max="3" step="0.1" value="1" onchange="updateCMEIntensity(this.value)">
            </div>

            <div class="control-group">
                <label class="control-label">üîç View Mode</label>
                <button class="control-button active" onclick="setViewMode('solar_system')">Solar System</button>
                <button class="control-button" onclick="setViewMode('earth_focus')">Earth Focus</button>
                <button class="control-button" onclick="setViewMode('sun_focus')">Sun Focus</button>
            </div>
        </div>

        <!-- Data Panel -->
        <div id="data-panel" class="hud-panel">
            <div class="panel-title">üìä LIVE NASA DATA</div>
            <div id="events-list">
                <div class="loading-spinner spinning">üåÄ Loading NASA DONKI data...</div>
            </div>
        </div>

        <!-- Timeline Panel -->
        <div id="timeline-panel" class="hud-panel">
            <div class="panel-title">‚è±Ô∏è EVENT TIMELINE</div>
            <div class="timeline-container">
                <div class="timeline-track"></div>
                <div class="timeline-marker" id="timeline-marker" style="left: 50%;"></div>
            </div>
            <div style="text-align: center; margin-top: 10px; font-size: 0.9rem;">
                <span id="timeline-date">Loading timeline...</span>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let scene, camera, renderer, controls;
        let sun, earth, moon;
        let cmeObjects = [];
        let flareObjects = [];
        let animationPaused = false;
        let cameraSpeed = 1;
        let cmeIntensity = 1;
        let currentViewMode = 'solar_system';
        let nasaData = null;

        // Initialize the 3D scene
        function init() {
            console.log('üöÄ Initializing Enhanced 3D Solar System...');

            // Create scene
            scene = new THREE.Scene();
            scene.fog = new THREE.Fog(0x000011, 50, 2000);

            // Create camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 10000);
            camera.position.set(0, 50, 100);

            // Create renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0x000011);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.getElementById('canvas-container').appendChild(renderer.domElement);

            // Create star field
            createStarField();

            // Create solar system objects
            createSolarSystem();

            // Setup lighting
            setupLighting();

            // Setup controls (basic orbit controls)
            setupControls();

            // Load NASA data
            loadNASAData();

            // Start animation loop
            animate();

            // Setup resize handler
            window.addEventListener('resize', onWindowResize);

            console.log('‚úÖ 3D Solar System initialized successfully!');
        }

        function createStarField() {
            const starGeometry = new THREE.BufferGeometry();
            const starCount = 10000;
            const positions = new Float32Array(starCount * 3);

            for (let i = 0; i < starCount * 3; i++) {
                positions[i] = (Math.random() - 0.5) * 2000;
            }

            starGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            const starMaterial = new THREE.PointsMaterial({ 
                color: 0xffffff, 
                size: 0.5,
                transparent: true,
                opacity: 0.8
            });

            const stars = new THREE.Points(starGeometry, starMaterial);
            scene.add(stars);
        }

        function createSolarSystem() {
            // Create Sun
            const sunGeometry = new THREE.SphereGeometry(10, 32, 32);
            const sunMaterial = new THREE.MeshBasicMaterial({ 
                color: 0xffff00,
                emissive: 0xff8800,
                emissiveIntensity: 0.5
            });
            sun = new THREE.Mesh(sunGeometry, sunMaterial);
            sun.position.set(0, 0, 0);
            scene.add(sun);

            // Create Earth
            const earthGeometry = new THREE.SphereGeometry(3, 32, 32);
            const earthMaterial = new THREE.MeshPhongMaterial({ 
                color: 0x0066cc,
                emissive: 0x001122,
                shininess: 100
            });
            earth = new THREE.Mesh(earthGeometry, earthMaterial);
            earth.position.set(75, 0, 0);
            scene.add(earth);

            // Create Moon
            const moonGeometry = new THREE.SphereGeometry(1, 16, 16);
            const moonMaterial = new THREE.MeshPhongMaterial({ 
                color: 0xcccccc,
                emissive: 0x222222
            });
            moon = new THREE.Mesh(moonGeometry, moonMaterial);
            moon.position.set(82, 0, 0);
            scene.add(moon);

            // Add orbital paths
            createOrbitalPaths();
        }

        function createOrbitalPaths() {
            // Earth orbit
            const earthOrbitGeometry = new THREE.RingGeometry(74, 76, 64);
            const earthOrbitMaterial = new THREE.MeshBasicMaterial({ 
                color: 0x0066cc, 
                transparent: true, 
                opacity: 0.2,
                side: THREE.DoubleSide
            });
            const earthOrbit = new THREE.Mesh(earthOrbitGeometry, earthOrbitMaterial);
            earthOrbit.rotation.x = Math.PI / 2;
            scene.add(earthOrbit);
        }

        function setupLighting() {
            // Ambient light
            const ambientLight = new THREE.AmbientLight(0x404040, 0.3);
            scene.add(ambientLight);

            // Sun light
            const sunLight = new THREE.PointLight(0xffffff, 2, 500);
            sunLight.position.set(0, 0, 0);
            sunLight.castShadow = true;
            scene.add(sunLight);

            // Directional light for better visibility
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
            directionalLight.position.set(10, 10, 5);
            scene.add(directionalLight);
        }

        function setupControls() {
            // Basic mouse controls for camera
            let mouseDown = false;
            let mouseX = 0;
            let mouseY = 0;

            renderer.domElement.addEventListener('mousedown', (event) => {
                mouseDown = true;
                mouseX = event.clientX;
                mouseY = event.clientY;
            });

            renderer.domElement.addEventListener('mouseup', () => {
                mouseDown = false;
            });

            renderer.domElement.addEventListener('mousemove', (event) => {
                if (mouseDown) {
                    const deltaX = event.clientX - mouseX;
                    const deltaY = event.clientY - mouseY;

                    // Rotate camera around the scene
                    const spherical = new THREE.Spherical();
                    spherical.setFromVector3(camera.position);
                    spherical.theta -= deltaX * 0.01 * cameraSpeed;
                    spherical.phi += deltaY * 0.01 * cameraSpeed;
                    spherical.phi = Math.max(0.1, Math.min(Math.PI - 0.1, spherical.phi));

                    camera.position.setFromSpherical(spherical);
                    camera.lookAt(0, 0, 0);

                    mouseX = event.clientX;
                    mouseY = event.clientY;
                }
            });

            // Zoom with mouse wheel
            renderer.domElement.addEventListener('wheel', (event) => {
                const scale = event.deltaY > 0 ? 1.1 : 0.9;
                camera.position.multiplyScalar(scale);
                camera.position.clampLength(20, 500);
            });
        }

        function loadNASAData() {
            console.log('üì° Loading NASA space weather data...');
            
            if (window.LIVE_NASA_DATA && window.LIVE_NASA_DATA.events) {
                nasaData = window.LIVE_NASA_DATA;
                console.log('‚úÖ Found live NASA data:', nasaData);
                
                updateDataDisplay();
                createCMEVisualizations();
                createFlareVisualizations();
                updateConnectionStatus('connected');
                
            } else {
                console.log('‚è≥ NASA data not yet available, creating demo...');
                updateConnectionStatus('connecting');
                createDemoData();
                setTimeout(loadNASAData, 3000);
            }
        }
        
        function createDemoData() {
            console.log('üé≠ Creating demo data for immediate display...');
            
            // Create fake data to show something immediately
            nasaData = {
                summary: {
                    cme_count: 5,
                    solar_flare_count: 3,
                    total_events: 8
                },
                events: {
                    cmes: [
                        { id: 'DEMO_CME_001', speed: 650, start_time: new Date().toISOString() },
                        { id: 'DEMO_CME_002', speed: 890, start_time: new Date().toISOString() },
                        { id: 'DEMO_CME_003', speed: 420, start_time: new Date().toISOString() }
                    ],
                    solar_flares: [
                        { id: 'DEMO_FLARE_001', class_type: 'M2.5', start_time: new Date().toISOString() },
                        { id: 'DEMO_FLARE_002', class_type: 'C8.1', start_time: new Date().toISOString() }
                    ]
                }
            };
            
            updateDataDisplay();
            createCMEVisualizations();
            createFlareVisualizations();
            updateConnectionStatus('connecting');
        }

        function updateDataDisplay() {
            if (!nasaData) return;

            const summary = nasaData.summary;
            
            // Update status counters
            document.getElementById('cme-count').textContent = summary.cme_count || 0;
            document.getElementById('flare-count').textContent = summary.solar_flare_count || 0;
            
            // Determine activity level
            const totalEvents = summary.total_events || 0;
            let activityLevel = 'QUIET';
            if (totalEvents > 30) activityLevel = 'EXTREME';
            else if (totalEvents > 20) activityLevel = 'HIGH';
            else if (totalEvents > 10) activityLevel = 'MODERATE';
            else if (totalEvents > 5) activityLevel = 'LOW';
            
            document.getElementById('activity-level').textContent = activityLevel;

            // Update events list
            const eventsList = document.getElementById('events-list');
            eventsList.innerHTML = '';

            // Add CME events
            nasaData.events.cmes.slice(0, 8).forEach(cme => {
                const eventItem = document.createElement('div');
                eventItem.className = 'event-item';
                eventItem.innerHTML = `
                    <div class="event-id">üåÄ CME ${cme.id.slice(-8)}</div>
                    <div class="event-details">
                        Speed: ${cme.speed || 'Unknown'} km/s<br>
                        Source: ${cme.source_location || 'Unknown'}<br>
                        Time: ${new Date(cme.start_time).toLocaleString()}
                    </div>
                `;
                eventItem.onclick = () => focusOnEvent(cme, 'cme');
                eventsList.appendChild(eventItem);
            });

            // Add solar flare events
            nasaData.events.solar_flares.slice(0, 5).forEach(flare => {
                const eventItem = document.createElement('div');
                eventItem.className = 'event-item';
                eventItem.style.borderColor = '#ff0000';
                eventItem.innerHTML = `
                    <div class="event-id" style="color: #ff0000;">‚òÄÔ∏è FLARE ${flare.class_type || 'C1.0'}</div>
                    <div class="event-details">
                        Class: ${flare.class_type || 'Unknown'}<br>
                        Source: ${flare.source_location || 'Unknown'}<br>
                        Time: ${new Date(flare.start_time).toLocaleString()}
                    </div>
                `;
                eventItem.onclick = () => focusOnEvent(flare, 'flare');
                eventsList.appendChild(eventItem);
            });
        }

        function createCMEVisualizations() {
            // Clear existing CME objects
            cmeObjects.forEach(obj => scene.remove(obj));
            cmeObjects = [];

            if (!nasaData || !nasaData.events.cmes) return;

            nasaData.events.cmes.slice(0, 10).forEach((cme, index) => {
                const speed = cme.speed || 500;
                const size = Math.log(speed / 100) * cmeIntensity;
                
                // Create CME particle system
                const particleCount = 200;
                const geometry = new THREE.BufferGeometry();
                const positions = new Float32Array(particleCount * 3);
                const colors = new Float32Array(particleCount * 3);

                for (let i = 0; i < particleCount; i++) {
                    const i3 = i * 3;
                    const angle = (Math.random() - 0.5) * Math.PI * 0.3;
                    const distance = 15 + Math.random() * 30;
                    
                    positions[i3] = Math.cos(angle) * distance;
                    positions[i3 + 1] = (Math.random() - 0.5) * 10;
                    positions[i3 + 2] = Math.sin(angle) * distance;

                    // Color based on speed
                    const intensity = Math.min(speed / 1000, 1);
                    colors[i3] = 1;
                    colors[i3 + 1] = 1 - intensity;
                    colors[i3 + 2] = 0;
                }

                geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
                geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));

                const material = new THREE.PointsMaterial({
                    size: size,
                    transparent: true,
                    opacity: 0.8,
                    vertexColors: true,
                    blending: THREE.AdditiveBlending
                });

                const cmeParticles = new THREE.Points(geometry, material);
                cmeParticles.userData = { 
                    type: 'cme', 
                    data: cme, 
                    speed: speed,
                    startTime: Date.now()
                };
                
                scene.add(cmeParticles);
                cmeObjects.push(cmeParticles);
            });

            console.log(`‚úÖ Created ${cmeObjects.length} CME visualizations`);
        }

        function createFlareVisualizations() {
            // Clear existing flare objects
            flareObjects.forEach(obj => scene.remove(obj));
            flareObjects = [];

            if (!nasaData || !nasaData.events.solar_flares) return;

            nasaData.events.solar_flares.slice(0, 5).forEach((flare, index) => {
                // Create flare as bright burst near sun
                const flareGeometry = new THREE.SphereGeometry(2, 16, 16);
                const flareMaterial = new THREE.MeshBasicMaterial({
                    color: 0xff0000,
                    transparent: true,
                    opacity: 0.8
                });

                const flareObject = new THREE.Mesh(flareGeometry, flareMaterial);
                const angle = (index / nasaData.events.solar_flares.length) * Math.PI * 2;
                flareObject.position.set(
                    Math.cos(angle) * 12,
                    (Math.random() - 0.5) * 5,
                    Math.sin(angle) * 12
                );

                flareObject.userData = { 
                    type: 'flare', 
                    data: flare,
                    startTime: Date.now()
                };

                scene.add(flareObject);
                flareObjects.push(flareObject);
            });

            console.log(`‚úÖ Created ${flareObjects.length} solar flare visualizations`);
        }

        function updateConnectionStatus(status) {
            const dataStatus = document.getElementById('data-status');
            const indicator = dataStatus.querySelector('.connection-indicator');
            
            indicator.className = `connection-indicator ${status}`;
            
            switch (status) {
                case 'connected':
                    dataStatus.innerHTML = '<span class="connection-indicator connected"></span>LIVE NASA';
                    break;
                case 'connecting':
                    dataStatus.innerHTML = '<span class="connection-indicator connecting"></span>CONNECTING';
                    break;
                case 'disconnected':
                    dataStatus.innerHTML = '<span class="connection-indicator disconnected"></span>OFFLINE';
                    break;
            }
        }

        function animate() {
            requestAnimationFrame(animate);

            if (!animationPaused) {
                const time = Date.now() * 0.001;

                // Rotate sun
                if (sun) {
                    sun.rotation.y += 0.01;
                }

                // Orbit earth around sun
                if (earth) {
                    earth.position.x = Math.cos(time * 0.1) * 75;
                    earth.position.z = Math.sin(time * 0.1) * 75;
                    earth.rotation.y += 0.02;
                }

                // Orbit moon around earth
                if (moon) {
                    moon.position.x = earth.position.x + Math.cos(time * 0.5) * 7;
                    moon.position.z = earth.position.z + Math.sin(time * 0.5) * 7;
                }

                // Animate CME particles
                cmeObjects.forEach(cme => {
                    const elapsed = (Date.now() - cme.userData.startTime) / 1000;
                    const positions = cme.geometry.attributes.position.array;
                    
                    for (let i = 0; i < positions.length; i += 3) {
                        // Move particles outward from sun
                        const speed = cme.userData.speed / 1000;
                        positions[i] += Math.cos(elapsed * speed) * 0.1;
                        positions[i + 2] += Math.sin(elapsed * speed) * 0.1;
                    }
                    
                    cme.geometry.attributes.position.needsUpdate = true;
                });

                // Animate solar flares
                flareObjects.forEach(flare => {
                    const elapsed = (Date.now() - flare.userData.startTime) / 1000;
                    flare.material.opacity = 0.8 * (1 + Math.sin(elapsed * 5) * 0.3);
                    flare.scale.setScalar(1 + Math.sin(elapsed * 3) * 0.2);
                });
            }

            renderer.render(scene, camera);
        }

        // Control functions
        function toggleAnimation() {
            animationPaused = !animationPaused;
            console.log('Animation:', animationPaused ? 'Paused' : 'Playing');
        }

        function resetView() {
            camera.position.set(0, 50, 100);
            camera.lookAt(0, 0, 0);
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        function updateCameraSpeed(value) {
            cameraSpeed = parseFloat(value);
        }

        function updateCMEIntensity(value) {
            cmeIntensity = parseFloat(value);
            if (nasaData) {
                createCMEVisualizations();
            }
        }

        function setViewMode(mode) {
            currentViewMode = mode;
            
            // Update button states
            document.querySelectorAll('.control-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Adjust camera for different view modes
            switch (mode) {
                case 'solar_system':
                    camera.position.set(0, 50, 100);
                    break;
                case 'earth_focus':
                    camera.position.set(75, 30, 50);
                    break;
                case 'sun_focus':
                    camera.position.set(0, 20, 40);
                    break;
            }
            camera.lookAt(0, 0, 0);
        }

        function focusOnEvent(eventData, type) {
            console.log(`Focusing on ${type}:`, eventData);
            
            if (type === 'cme') {
                // Find corresponding CME object and focus camera
                setViewMode('sun_focus');
            } else if (type === 'flare') {
                // Focus on sun for flare events
                setViewMode('sun_focus');
            }
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // WebSocket real-time update handler
        window.updateSolarSystemWithLiveData = function(data) {
            console.log('üåü Solar System receiving real-time data:', data);
            
            if (data.events) {
                nasaData = data;
                updateDataDisplay();
                createCMEVisualizations();
                createFlareVisualizations();
            }
        };

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ Starting Enhanced 3D Solar System...');
            init();
        });
    </script>
</body>
</html>